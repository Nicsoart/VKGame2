<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Unity WebGL Player | AdvertisingTest</title>
    <link rel="shortcut icon" href="TemplateData/favicon.ico">
    <link rel="stylesheet" href="TemplateData/style.css">
    <script src="TemplateData/UnityProgress.js"></script>
    <script src="Build/UnityLoader.js"></script>
    <script>
      var unityInstance = UnityLoader.instantiate("unityContainer", "Build/Build96.json", {onProgress: UnityProgress});
    </script>

    <script type = "text/javascript" language = "javascript">
    var fullscreenID;
    var mobilefullscreenID;
    var horizontalbannerID;
    var mobilebannerID;
    var rewardvideoID;
    var mobilerewardvideoID;

    var VKfullscreenID = 'R-A-1343857-1';
    var VKmobilefullscreenID = 'R-A-1343857-4';
    var VKhorizontalbannerID = 'R-A-1343857-2';
    var VKmobilebannerID = 'R-A-1343857-6';
    var VKrewardvideoID = 'R-A-1343857-3';
    var VKmobilerewardvideoID = 'R-A-1343857-5';

    var OKfullscreenID = 'R-A-1462161-1';
    var OKmobilefullscreenID = 'R-A-1462161-4';
    var OKhorizontalbannerID = 'R-A-1462161-2';
    var OKmobilebannerID = 'R-A-1462161-6';
    var OKrewardvideoID = 'R-A-1462161-3';
    var OKmobilerewardvideoID = 'R-A-1462161-5';

    var text;
    var link;
    </script>

    <!-- Yandex.RTB -->
    <script>window.yaContextCb=window.yaContextCb||[]</script>
    <script src="https://yandex.ru/ads/system/context.js" async></script>
    <!-- VK.API -->
    <script src="https://vk.com/js/api/xd_connection.js?2"  type="text/javascript"></script>
    <!-- VK.bridge -->
    <script src="https://unpkg.com/@vkontakte/vk-bridge/dist/browser.min.js"></script>
    <!-- OK -->
    <script type="text/javascript" src="//api.ok.ru/js/fapi5.js" defer="defer"></script>

  </head>
  <body>
    <div class="webgl-content">

    <div id="unityContainer" style="position:relative; width: 100vw; height: 100vh; background: #CD5C5C"></div>

    <!-- VK Full Screen -->
    <div id="yandex_rtb_R-A-1343857-1" style="position: absolute; top: 16%; width: 100vw; height: 67vh; background: #FFD700"></div>

    <!-- VK Mobile Full Screen -->
    <div id="yandex_rtb_R-A-1343857-4" style="position: absolute; top: 16%; width: 100vw; height: 67vh; background: #FFA500"></div>

    <!-- VK Horizontal Banner -->
    <div id="yandex_rtb_R-A-1343857-2" style="position: absolute; bottom: 0;  width: 100vw; height: 10vh; background: #C71585"></div>

    <!-- VK Mobile Banner -->
    <div id="yandex_rtb_R-A-1343857-6" style="position: absolute;  bottom: 0; width: 100vw; height: 10vh; background: #8A2BE2"></div>

    <!-- VK Reward Video -->
    <div id="yandex_rtb_R-A-1343857-3" style="position: absolute; top: 16%; width: 100vw; height: 67vh; background: #8B4513"></div>

    <!-- VK Mobile Reward Video -->
    <div id="yandex_rtb_R-A-1343857-5" style="position: absolute; top: 16%; width: 100vw; height: 67vh; background: #4682B4"></div>


    <!-- OK Full Screen -->
    <div id="yandex_rtb_R-A-1462161-1" style="position: absolute; top: 16%; width: 100vw; height: 67vh; background: #7FFF00"></div>

    <!-- OK Mobile Full Screen -->
    <div id="yandex_rtb_R-A-1462161-4" style="position: absolute; top: 16%; width: 100vw; height: 67vh; background: #DC143C"></div>

    <!-- OK Horizontal Banner -->
    <div id="yandex_rtb_R-A-1462161-2" style="position: absolute; bottom: 0;  width: 100vw; height: 10vh; background: #FFA500"></div>

    <!-- OK Mobile Banner -->
    <div id="yandex_rtb_R-A-1462161-6" style="position: absolute;  bottom: 0; width: 100vw; height: 10vh; background: #CD853F"></div>

    <!-- OK Reward Video -->
    <div id="yandex_rtb_R-A-1462161-3" style="position: absolute; top: 16%; width: 100vw; height: 67vh; background: #A52A2A"></div>

    <!-- OK Mobile Reward Video -->
    <div id="yandex_rtb_R-A-1462161-5" style="position: absolute; top: 16%; width: 100vw; height: 67vh; background: #000080"></div>

    </div>

    <script type = "text/javascript" language = "javascript">

// Initialization
    function AdsInitialization() {
      document.getElementById('yandex_rtb_' + VKfullscreenID).style.display = 'none';
      document.getElementById('yandex_rtb_' + VKmobilefullscreenID).style.display = 'none';
      document.getElementById('yandex_rtb_' + VKhorizontalbannerID).style.display = 'none';
      document.getElementById('yandex_rtb_' + VKmobilebannerID).style.display = 'none';
      document.getElementById('yandex_rtb_' + VKrewardvideoID).style.display = 'none';
      document.getElementById('yandex_rtb_' + VKmobilerewardvideoID).style.display = 'none';


      document.getElementById('yandex_rtb_' + OKfullscreenID).style.display = 'none';
      document.getElementById('yandex_rtb_' + OKmobilefullscreenID).style.display = 'none';
      document.getElementById('yandex_rtb_' + OKhorizontalbannerID).style.display = 'none';
      document.getElementById('yandex_rtb_' + OKmobilebannerID).style.display = 'none';
      document.getElementById('yandex_rtb_' + OKrewardvideoID).style.display = 'none';
      document.getElementById('yandex_rtb_' + OKmobilerewardvideoID).style.display = 'none';

      unityInstance.SendMessage('AdsManager', 'VerticalInitialization', 1);
    }

    function PlatformInitialization() {
      try {
        var rParams = FAPI.Util.getRequestParameters();
        console.log(rParams);
        if (rParams.vk_client !== "undefined" && rParams.vk_client == "ok") {
          console.log("ok");
          unityInstance.SendMessage('VKMechanicsController', 'OKInitialization');
          fullscreenID = OKfullscreenID;
          mobilefullscreenID = OKmobilefullscreenID;
          horizontalbannerID = OKhorizontalbannerID;
          mobilebannerID = OKmobilebannerID;
          rewardvideoID = OKrewardvideoID;
        } else {
          console.log("vk");
          unityInstance.SendMessage('VKMechanicsController', 'VKInitialization');
          fullscreenID = VKfullscreenID;
          mobilefullscreenID = VKmobilefullscreenID;
          horizontalbannerID = VKhorizontalbannerID;
          mobilebannerID = VKmobilebannerID;
          rewardvideoID = VKrewardvideoID;
        }
      } catch (e) {
        console.log("vk");
        unityInstance.SendMessage('VKMechanicsController', 'VKInitialization');
        fullscreenID = VKfullscreenID;
        mobilefullscreenID = VKmobilefullscreenID;
        horizontalbannerID = VKhorizontalbannerID;
        mobilebannerID = VKmobilebannerID;
        rewardvideoID = VKrewardvideoID;
      }
    }

// OK
  function API_callback(method, result, data) {
    console.log(method);
    console.log(result);
    console.log(data);
  }

  function OKInitialization() {
    vkBridge.send('VKWebAppInit').then(res => {
      var rParams = FAPI.Util.getRequestParameters();
      unityInstance.SendMessage('PlayerManager', 'GetPlayerLanguage', rParams.vk_language);
      vkBridge.send("VKWebAppGetUserInfo").then(res => {
        let userName = res.first_name + " " + res.last_name;
        let userPhoto = res.photo_200;
        unityInstance.SendMessage('PlayerManager', 'GetPlayerName', userName);
        unityInstance.SendMessage('PlayerManager', 'GetPlayerPhoto', userPhoto);
        unityInstance.SendMessage('PlayerManager', 'PlayerAuthorized');
      })
    });
    vkBridge.send('OKWebAppCallAPIMethod',
      {"method" : "friends.getByDevices", "request_id" : "getByDevices",
      "params": { "devices" : ["IOS", "ANDROID"]}
    }).then(res => {
      if (res.response == 0) {
        unityInstance.SendMessage('VKMechanicsController', 'NoInvite');
      }
    })
  }

    function ShowOKInterstational() {
      console.log('ShowOKInterstational');
      unityInstance.SendMessage('AdsManager', 'TryToLoadFullScreen');
    }

    function ShowOKRewardVideo() {
      console.log('ShowOKRewardVideo');
      unityInstance.SendMessage('AdsManager', 'TryToLoadCustomRewardVideo');
    }

    function OKInvite(text, link) {
      vkBridge.send('OKWebAppCallAPIMethod',
        {"method" : "friends.getByDevices", "request_id" : "getByDevices",
        "params": { "devices" : ["IOS", "ANDROID"]}
      }).then(res => {
        if (res.response > 0) {
          vkBridge.send('OKWebAppCallAPIMethod',
            {"method" : "friends.appInvite", "request_id" : "appInvite",
              "params": {"uids" : usersID, "text" : text + "\n" + link, "devices" : ["IOS", "ANDROID"]}
            }
          ).catch(err => {
            unityInstance.SendMessage('VKMechanicsController', 'NoInvite');
          })
        } else {
          unityInstance.SendMessage('VKMechanicsController', 'NoInvite');
        }
      }).catch(err => {
        unityInstance.SendMessage('VKMechanicsController', 'NoInvite');
      })
    }

    // VK
    function VKInitialization() {
      VK.init(function() {
      }, function() {
        VKInitialization();
      }, '5.131');
      VKMobileInitialization();
    }

    function VKMobileInitialization()
    {
      vkBridge.send('VKWebAppInit').then(res => {
        vkBridge.send("VKWebAppGetLaunchParams").then(res => {
          unityInstance.SendMessage('PlayerManager', 'GetPlayerLanguage', res.vk_language);
          if (res.vk_is_favorite === 1) {
            unityInstance.SendMessage('VKMechanicsController', 'InFavorite');
          }
        });

        vkBridge.send("VKWebAppGetUserInfo").then(res => {
          let userName = res.first_name + " " + res.last_name;
          let userPhoto = res.photo_200;
          unityInstance.SendMessage('PlayerManager', 'GetPlayerName', userName);
          unityInstance.SendMessage('PlayerManager', 'GetPlayerPhoto', userPhoto);
          unityInstance.SendMessage('PlayerManager', 'PlayerAuthorized');
        });

        vkBridge.send("VKWebAppAddToHomeScreenInfo").then(res => {
          if (res.is_feature_supported === false) {
            unityInstance.SendMessage('VKMechanicsController', 'Added');
          } else {
            if (res.is_added_to_home_screen === true) {
              unityInstance.SendMessage('VKMechanicsController', 'Added');
            }
          }
        })
      })
    }

    function ShowVKInterstational() {
      console.log('ShowVKInterstational');
      vkBridge.send("VKWebAppShowNativeAds", {ad_format:"interstitial"})
      .then(data =>{
        unityInstance.SendMessage('AdsManager', 'AdShowed');
      })
      .catch(error =>{
        console.log(error);
        unityInstance.SendMessage('AdsManager', 'TryToLoadFullScreen');
      });
    }

    function ShowVKRewardVideo() {
      console.log('ShowVKRewardVideo');
      vkBridge.send("VKWebAppShowNativeAds", {ad_format:"reward"})
      .then(data => {
        unityInstance.SendMessage('AdsManager', 'GetReward');
      })
      .catch(error => {
        console.log(error);
        unityInstance.SendMessage('AdsManager', 'TryToLoadCustomRewardVideo');
      });
    }

    function VKInvite() {
      vkBridge.send("VKWebAppShowInviteBox").catch(err => {
        VK.callMethod("showInviteBox");
      })
    }

    function VKMobileInvite() {
      console.log("VKMobileInvite");
      vkBridge.send("VKWebAppShowInviteBox");
    }

    function VKPublish(text, link) {
      vkBridge.send("VKWebAppShowWallPostBox", {
        "message": text,
        "attachments": link
      }).catch(err => {
        if (err.error_type !== "client_error") {
          VK.api("wall.post", {"message": text, "attachments" : link, "v":"5.73"}, function (data) {
          })
        }
      })
    }

    function VKMobilePublish(text, link) {
      console.log(text + ", " + link);
      vkBridge.send("VKWebAppShowWallPostBox", {
        "message": text,
        "attachments": link
      });
    }

    function VKAddInMenu() {
      VK.callMethod("showSettingsBox", 256);
    }

    function VKAddToHomeScreen() {
      vkBridge.send("VKWebAppAddToHomeScreen").then(res => {
        if (res.is_added_to_home_screen === true) {
          unityInstance.SendMessage('VKMechanicsController', 'Added');
        }
      })
    }

    function VKFavorite() {
      vkBridge.send("VKWebAppAddToFavorites").then(res => {
        console.log(res);
        if (res.result == true) {
          unityInstance.SendMessage('VKMechanicsController', 'InFavorite');
        }
      })
    }

// Full Screen
    function ShowFullScreen() {
      console.log('ShowFullScreen');
      document.getElementById('yandex_rtb_' + fullscreenID).style.display = 'block';
      Ya.Context.AdvManager.render({
        renderTo: 'yandex_rtb_' + fullscreenID,
        blockId: fullscreenID,
        onError: (data) => {
          console.log(data);
          unityInstance.SendMessage('AdsManager', 'CloseFullScreen');
        },
        onRender: (data) => {
          unityInstance.SendMessage('AdsManager', 'FullScreenLoaded');
        }
      })
    }

    function ShowMobileFullScreen() {
      document.getElementById('yandex_rtb_' + mobilefullscreenID).style.display = 'block';
      Ya.Context.AdvManager.render({
        renderTo: 'yandex_rtb_' + mobilefullscreenID,
        blockId: mobilefullscreenID,
        onError: (data) => {
          console.log(data);
          unityInstance.SendMessage('AdsManager', 'CloseFullScreen');
        },
        onRender: (data) => {
          unityInstance.SendMessage('AdsManager', 'FullScreenLoaded');
        }
      })
    }

    function CloseFullScreen() {
      document.getElementById('yandex_rtb_' + fullscreenID).style.display = 'none';
    }

    function CloseMobileFullScreen() {
      document.getElementById('yandex_rtb_' + mobilefullscreenID).style.display = 'none';
    }

// Banner
    function ShowBanner() {
      document.getElementById('yandex_rtb_' + horizontalbannerID).style.display = 'block';
      Ya.Context.AdvManager.render({
        renderTo: 'yandex_rtb_' + horizontalbannerID,
        blockId: horizontalbannerID,
        onError: (data) => {
          console.log(data);
          unityInstance.SendMessage('AdsManager', 'CloseBanner');
        }
      })
    }

    function ShowMobileBanner() {
      document.getElementById('yandex_rtb_' + mobilebannerID).style.display = 'block';
      Ya.Context.AdvManager.render({
        renderTo: 'yandex_rtb_' + mobilebannerID,
        blockId: mobilebannerID,
        onError: (data) => {
          console.log(data);
          unityInstance.SendMessage('AdsManager', 'CloseBanner');
        }
      })
    }

    function CloseBanner() {
      document.getElementById('yandex_rtb_' + horizontalbannerID).style.display = 'none';
    }

    function CloseMobileBanner() {
      document.getElementById('yandex_rtb_' + mobilebannerID).style.display = 'none';
    }

// Custon Reward Video
    function ShowCustomRewardVideo() {
      document.getElementById('yandex_rtb_' + rewardvideoID).style.display = 'block';
      Ya.Context.AdvManager.render({
        renderTo: 'yandex_rtb_' + rewardvideoID,
        blockId: rewardvideoID,
        onError: (data) => {
          console.log(data);
          unityInstance.SendMessage('AdsManager', 'CloseCustomRewardVideo');
        },
        onRender: (data) => {
          unityInstance.SendMessage('AdsManager', 'CustomRewardVideoLoaded');
        }
      })
    }

    function CloseCustomRewardVideo() {
      document.getElementById('yandex_rtb_' + rewardvideoID).style.display = 'none';
    }

    function ShowMobileCustomRewardVideo() {
      document.getElementById('yandex_rtb_' + rewardvideoID).style.display = 'block';
      Ya.Context.AdvManager.render({
        renderTo: 'yandex_rtb_' + rewardvideoID,
        blockId: rewardvideoID,
        onError: (data) => {
          console.log(data);
          unityInstance.SendMessage('AdsManager', 'CloseCustomRewardVideo');
        },
        onRender: (data) => {
          unityInstance.SendMessage('AdsManager', 'CustomRewardVideoLoaded');
        }
      })
    }

    function CloseMobileCustomRewardVideo() {
      document.getElementById('yandex_rtb_' + rewardvideoID).style.display = 'none';
    }
  </script>
  </body>
</html>
